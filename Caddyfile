{
    email gabriel.rueda@metrolatam.com
}

# Configuración para el acortador de URLs - Solo s.metrolatam.com
s.metrolatam.com,
16.148.140.43.sslip.io {
    
    # API pasan al backend
    handle /api/* {
        reverse_proxy backend:8000
    }

    # Assets estáticos y Dashboard al frontend
    handle /_astro/* {
        reverse_proxy frontend:4321
    }
    handle /dashboard* {
        reverse_proxy frontend:4321
    }
    handle /favicon.png {
        reverse_proxy frontend:4321
    }
    handle /publimetro-logo.png {
        reverse_proxy frontend:4321
    }
    handle /@vite/* {
        reverse_proxy frontend:4321
    }
    handle /src/* {
        reverse_proxy frontend:4321
    }
    handle / {
        reverse_proxy frontend:4321
    }

    # Todo lo demás se asume que es un link corto y va al backend
    handle /* {
        reverse_proxy backend:8000
    }
}

# Acceso por IP (puerto 80)
:80 {
    # Mismo esquema que arriba
    handle /api/* {
        reverse_proxy backend:8000
    }
    handle /_astro/* {
        reverse_proxy frontend:4321
    }
    handle /dashboard* {
        reverse_proxy frontend:4321
    }
    handle /favicon.png {
        reverse_proxy frontend:4321
    }
    handle /publimetro-logo.png {
        reverse_proxy frontend:4321
    }
    handle /@vite/* {
        reverse_proxy frontend:4321
    }
    handle /src/* {
        reverse_proxy frontend:4321
    }
    handle / {
        reverse_proxy frontend:4321
    }
    handle /* {
        reverse_proxy backend:8000
    }
}
